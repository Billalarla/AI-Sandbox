{% extends 'base.html' %}

{% block title %}{{ call.subject }} - Call Details - WindCRM{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard:home' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'tasks:call_list' %}">Calls</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ call.subject }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-phone text-primary"></i> {{ call.subject }}</h1>
    <div class="btn-group" role="group">
        <a href="{% url 'tasks:call_edit' call.pk %}" class="btn btn-outline-primary">
            <i class="fas fa-edit"></i> Edit
        </a>
        <a href="{% url 'tasks:call_delete' call.pk %}" class="btn btn-outline-danger">
            <i class="fas fa-trash"></i> Delete
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Call Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Subject:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.subject }}
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Type:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge {% if call.call_type == 'inbound' %}bg-info{% else %}bg-primary{% endif %}">
                            {{ call.get_call_type_display }}
                        </span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Status:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge 
                            {% if call.status == 'completed' %}bg-success
                            {% elif call.status == 'in_progress' %}bg-warning
                            {% elif call.status == 'cancelled' %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                            {{ call.get_status_display }}
                        </span>
                    </div>
                </div>

                {% if call.call_result %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Result:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge bg-info">{{ call.get_call_result_display }}</span>
                    </div>
                </div>
                {% endif %}

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Phone Number:</strong>
                    </div>
                    <div class="col-sm-9">
                        <a href="tel:{{ call.phone_number }}" class="text-decoration-none">
                            <i class="fas fa-phone"></i> {{ call.phone_number }}
                        </a>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Scheduled:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.scheduled_datetime|date:"F d, Y g:i A" }}
                        {% if call.is_overdue %}
                            <span class="badge bg-danger ms-2">Overdue</span>
                        {% endif %}
                    </div>
                </div>

                {% if call.actual_start_time %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Started:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.actual_start_time|date:"F d, Y g:i A" }}
                    </div>
                </div>
                {% endif %}

                {% if call.actual_end_time %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Ended:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.actual_end_time|date:"F d, Y g:i A" }}
                    </div>
                </div>
                {% endif %}

                {% if call.duration_minutes %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Duration:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.duration_minutes }} minutes
                    </div>
                </div>
                {% endif %}

                {% if call.description %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Description:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.description|linebreaks }}
                    </div>
                </div>
                {% endif %}

                {% if call.call_notes %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Call Notes:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ call.call_notes|linebreaks }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Related Information -->
        <div class="card mb-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Related Information</h6>
            </div>
            <div class="card-body">
                {% if call.related_account %}
                <div class="mb-2">
                    <strong>Account:</strong><br>
                    <a href="{{ call.related_account.get_absolute_url }}" class="text-decoration-none">
                        <i class="fas fa-building"></i> {{ call.related_account.name }}
                    </a>
                </div>
                {% endif %}

                {% if call.related_contact %}
                <div class="mb-2">
                    <strong>Contact:</strong><br>
                    <a href="{{ call.related_contact.get_absolute_url }}" class="text-decoration-none">
                        <i class="fas fa-user"></i> {{ call.related_contact.first_name }} {{ call.related_contact.last_name }}
                    </a>
                </div>
                {% endif %}

                {% if call.related_lead %}
                <div class="mb-2">
                    <strong>Lead:</strong><br>
                    <a href="{{ call.related_lead.get_absolute_url }}" class="text-decoration-none">
                        <i class="fas fa-bullseye"></i> {{ call.related_lead.first_name }} {{ call.related_lead.last_name }}
                    </a>
                </div>
                {% endif %}

                {% if call.related_opportunity %}
                <div class="mb-2">
                    <strong>Opportunity:</strong><br>
                    <a href="{{ call.related_opportunity.get_absolute_url }}" class="text-decoration-none">
                        <i class="fas fa-handshake"></i> {{ call.related_opportunity.name }}
                    </a>
                </div>
                {% endif %}

                {% if not call.related_account and not call.related_contact and not call.related_lead and not call.related_opportunity %}
                <p class="text-muted">No related records.</p>
                {% endif %}
            </div>
        </div>

        <!-- Assignment Information -->
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">Assignment</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong>Assigned To:</strong><br>
                    <i class="fas fa-user"></i> {{ call.assigned_to.get_full_name|default:call.assigned_to.username }}
                </div>
                {% if call.created_by %}
                <div class="mb-2">
                    <strong>Created By:</strong><br>
                    <i class="fas fa-user-plus"></i> {{ call.created_by.get_full_name|default:call.created_by.username }}
                </div>
                {% endif %}
                <div class="mb-2">
                    <strong>Created:</strong><br>
                    <i class="fas fa-calendar"></i> {{ call.created_at|date:"F d, Y g:i A" }}
                </div>
                <div>
                    <strong>Modified:</strong><br>
                    <i class="fas fa-calendar-alt"></i> {{ call.updated_at|date:"F d, Y g:i A" }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
